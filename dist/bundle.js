(()=>{"use strict";var e,t,n,r,o,a,i,c,u,l=Object.freeze({gain:.5,numSamples:256}),s=(new Uint8Array(l.numSamples/2),function(e){t.src=e}),f=function(){i?(a.frequency.setValueAtTime(1e3,e.currentTime),a.gain.setValueAtTime(25,e.currentTime)):a.gain.setValueAtTime(0,e.currentTime),i=!i},d=function(){c?(u.frequency.setValueAtTime(1e3,e.currentTime),u.gain.setValueAtTime(15,e.currentTime)):u.gain.setValueAtTime(0,e.currentTime),c=!c};function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var y,m,g,v,p,b,w,S,k=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return"rgba(".concat(e,",").concat(t,",").concat(n,",").concat(r,")")};function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}function M(e){return function(e){if(Array.isArray(e))return T(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==q(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==q(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===q(o)?o:String(o)),r)}var o}function I(e,t,n){return t&&x(e.prototype,t),n&&x(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var C=[],j=[],P={x:innerWidth/2,y:innerHeight/2},E=function(){function e(t,n,r){A(this,e),Object.assign(this,{width:t,hue:n,offset:r})}return I(e,[{key:"update",value:function(e){var t=this,n=function(){var n=e[Math.round(Math.random()*e.length)];return 105+Math.round(n/e.length*t.hue)};this.color="rgba("+n()+","+n()+","+n()+",.5)"}},{key:"draw",value:function(e,t,n){var r=g/3*2,o=(Math.max.apply(Math,M(n))-Math.min.apply(Math,M(n)))/2;e.save(),e.lineWidth=this.width,e.strokeStyle=this.color,e.beginPath(),e.moveTo(-10,r+this.offset),e.bezierCurveTo(m/10*4,-o*t+this.offset,m/10*6,o*t+this.offset,m+10,r+this.offset),e.stroke(),e.restore()}}]),e}(),F=function(){function e(t,n,r){A(this,e),Object.assign(this,{clickx:t,clicky:n,length:r})}return I(e,[{key:"update",value:function(){Math.random()>=.5?this.clickx+=Math.round(2*Math.random()):this.clickx-=Math.round(2*Math.random()),Math.random()>=.5?this.clicky+=Math.round(2*Math.random()):this.clicky-=Math.round(2*Math.random())}},{key:"draw",value:function(e,t){if(0!=t.length){var n=360/t.length;e.save(),e.strokeStyle="rgba(255,255,255,0.50)";for(var r=0;r<t.length;r++){var o,a,i=z(n*r);e.beginPath(),o=this.clickx+t[r]*this.length*Math.cos(i*r),a=this.clicky+t[r]*this.length*Math.sin(i*r),e.moveTo(this.clickx,this.clicky),e.lineTo(o,a),e.stroke()}e.restore()}}},{key:"setPosition",value:function(e,t){this.clickx=e,this.clicky=t}}]),e}(),O=function(e,t){e.onmousemove=function(t){var n=L(t,e);P.x=n.x,P.y=n.y,b=!0},e.onmouseout=function(e){b=!1},e.onclick=function(e){document.fullscreenElement||j.push(new F(P.x,P.y,.2*Math.random()))},y=e.getContext("2d"),m=e.width,g=e.height,function(e,t,n,r,o,a){var i,c=e.createLinearGradient(0,0,0,o),u=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}([{percent:0,color:"#247c82"},{percent:.4,color:"#6e98db"},{percent:.6,color:"#5aad88"},{percent:1,color:"#248258"}]);try{for(u.s();!(i=u.n()).done;){var l=i.value;c.addColorStop(l.percent,l.color)}}catch(e){u.e(e)}finally{u.f()}}(y,0,0,0,g),v=t,p=new Uint8Array(v.fftSize/2),S=document.querySelector("#background"),C.push(new E(2,200,20)),C.push(new E(2,200,-20)),C.push(new E(20,100,0)),w=new F(m/2,g/2,1)},H=function(e,t,n,r){y.save(),y.beginPath(),y.fillStyle=r,y.arc(e,t,n,0,2*Math.PI,!1),y.fill(),y.closePath(),y.restore()},R=function(){j=[]},z=function(e){return e*(Math.PI/180)},L=function(e,t){var n=t.getBoundingClientRect(),r=t.width/n.width,o=t.height/n.height;return{x:(e.clientX-n.left)*r,y:(e.clientY-n.left)*o}};function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var V,B,U,G=function(n,r){document.querySelector("#btn-fs").onclick=function(e){var t;console.log("goFullscreen() called"),(t=n).requestFullscreen?t.requestFullscreen():t.mozRequestFullscreen?t.mozRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()};var a=document.querySelector("#btn-play");a.onclick=function(n){console.log("audioCtx.state before = ".concat(e.state)),"suspended"==e.state&&e.resume(),console.log("audioCtx.state after = ".concat(e.state)),"no"==n.target.dataset.playing?(t.play(),n.target.dataset.playing="yes"):(t.pause(),n.target.dataset.playing="no")},document.querySelector("#btn-clear").onclick=R;var i=document.querySelector("#volume-slider"),c=document.querySelector("#volume-label");i.oninput=function(e){var t;t=e.target.value,t=Number(t),o.gain.value=t,c.innerHTML=Math.round(e.target.value/2*100)},document.querySelector("#path-slider").oninput=function(e){V.lineIntensity=e.target.value,document.querySelector("#path-label").innerHTML=e.target.value},i.dispatchEvent(new Event("input"));var u,l=document.querySelector("#track-select"),h=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}(r.audioFiles);try{for(h.s();!(u=h.n()).done;){var y=u.value;l.innerHTML+='<option value="media/'.concat(y.filename,'">').concat(y.title,"</option>")}}catch(e){h.e(e)}finally{h.f()}l.firstChild.selected=!0,document.querySelector("#track-select").onchange=function(e){s(e.target.value),"yes"==a.dataset.playing&&a.dispatchEvent(new MouseEvent("click"))};var m=document.querySelector("#cb-stars"),g=document.querySelector("#cb-circles");m.checked=!0,m.onchange=function(e){V.showStars=e.target.checked},g.checked=!0,g.onchange=function(e){V.showCircles=e.target.checked},document.querySelector("#cb-invert").onchange=function(e){V.showInvert=e.target.checked},document.querySelector("#cb-emboss").onchange=function(e){V.showEmboss=e.target.checked},document.querySelector("#cb-highshelf").onchange=function(e){f()},document.querySelector("#cb-lowshelf").onchange=function(e){d()},f(),d(),document.querySelector("#cb-time").onchange=function(e){V.time=e.target.checked}},N=function e(){setTimeout(e,1e3/60),function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e="no"!=document.querySelector("#btn-play").dataset.playing,t.time?v.getByteTimeDomainData(p):v.getByteFrequencyData(p);var n=p.filter((function(e){return e>0}));if(y.save(),y.drawImage(S,0,0,m,g),y.restore(),e)for(var r=0;r<C.length;r++)Date.now()%20==0&&C[r].update(n),C[r].draw(y,t.lineIntensity,n);if(t.showCircles&&e){var o=g/10;y.save(),y.globalAlpha=.5;for(var a=0;a<n.length;a++){var i=n[a]/255,c=i*o;H(m-m/4,g/4,.3*c,"#02012c"),H(m-m/4,g/4,.5*c,k(255,255,255,.5-i/5)),H(m-m/4,g/4,c,k(221,237,237,.35-i/3)),H(m-m/4,g/4,1.5*c,k(221,229,237,.1-i/10))}y.restore()}if(t.showStars&&e){if(y.save(),e)for(var u=0;u<j.length;u++)j[u].update(),j[u].draw(y,n);y.strokeStyle="rgba(255,255,255,0.50)",b&&!document.fullscreenElement?(w.setPosition(P.x,P.y),w.draw(y,n)):(w.setPosition(m-m/4,g/4),w.draw(y,n)),y.restore()}for(var l=y.getImageData(0,0,m,g),s=l.data,f=s.length,d=l.width,h=0;h<f;h+=4)if(t.showInvert){var q=s[h],M=s[h+1],T=s[h+2];s[h]=255-q,s[h+1]=255-M,s[h+2]=255-T}if(t.showEmboss)for(var A=0;A<f;A++)A%4!=3&&(s[A]=127+2*s[A]-s[A+4]-s[A+4*d]);y.putImageData(l,0,0)}(V)},$=function(f){var d,h;document.querySelector("title").innerHTML=f.title,document.querySelector("#title").innerHTML=f.title,d="media/".concat(f.audioFiles[0].filename),h=window.AudioContext||window.webkitAudioContext,e=new h,t=new Audio,s(d),n=e.createMediaElementSource(t),(r=e.createAnalyser()).fftSize=l.numSamples,(o=e.createGain()).gain.value=l.gain,i=!1,(a=e.createBiquadFilter()).type="highshelf",c=!1,(u=e.createBiquadFilter()).type="lowshelf",n.connect(r),r.connect(u),u.connect(a),a.connect(o),o.connect(e.destination),V=f.initalParams;var y=document.querySelector("canvas");G(y,f),O(y,r),N()};console.log("window.onload called"),console.log("init called"),console.log("Testing utils.getRandomColor() import: ".concat("rgba(".concat((U=function(){return 185*Math.random()+35})(),",").concat(U(),",").concat(U(),",1)"))),(B=new XMLHttpRequest).onload=function(e){console.log("In onload - HTTP Status Code = ".concat(e.target.status));var t,n=e.target.responseText;try{t=JSON.parse(n)}catch(e){return void(document.querySelector("#output").innerHTML="JSON is null")}$(t)},B.onerror=function(e){return console.log("In onerror - HTTP Status Code = ".concat(e.target.status))},B.open("GET","data/av-data.json"),B.send()})();